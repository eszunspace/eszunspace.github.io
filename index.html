<!doctype html>
<html lang="es">

<head>
  <meta name="title" content="INICIO ‚Äì EsZunSpace">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>INICIO ‚Äì EsZunSpace</title>
  <!-- Social preview -->
  <meta name="description" content="Descubre EsZunSpace: cohetes, motores, sat√©lites y lanzamientos.">
  <link rel="canonical" href="https://eszunspace.es/">
  <meta property="og:type" content="website">
  <meta property="og:site_name" content="EsZunSpace">
  <meta property="og:title" content="INICIO ‚Äì EsZunSpace">
  <meta property="og:description" content="Descubre EsZunSpace: cohetes, motores, sat√©lites y lanzamientos.">
  <meta property="og:url" content="https://eszunspace.es/">
  <meta property="og:image" content="https://eszunspace.es/logoarriba.jpg">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="INICIO ‚Äì EsZunSpace">
  <meta name="twitter:description" content="Descubre EsZunSpace: cohetes, motores, sat√©lites y lanzamientos.">
  <meta name="twitter:image" content="https://eszunspace.es/logoarriba.jpg">
  <meta name="theme-color" content="#0b0b0f">


  <link
    href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&family=Space+Grotesk:wght@500;700&display=swap"
    rel="stylesheet">
  <link rel="icon" type="image/jpeg" href="logoarriba.jpg">

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

  <style>
    :root {
      --bg-image: url('background.jpg');
      --header-h: 64px;
    }

    * {
      box-sizing: border-box;
    }

    html,
    body {
      height: 100%;
      margin: 0;
    }

    body {
      font-family: 'Poppins', system-ui, sans-serif;
      color: #fff;
      background: #000;
      opacity: 0;
      transition: opacity 0.6s ease;
    }

    body.fade-in {
      opacity: 1;
    }

    body.fade-out {
      opacity: 0;
    }

    /* ===== Header c√°psula con marcador activo ===== */
    header.topbar {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1000;
      padding: 12px 12px;
      background: linear-gradient(180deg, rgba(0, 0, 0, .65) 0%, rgba(0, 0, 0, 0) 100%);
      -webkit-backdrop-filter: blur(2px);
      backdrop-filter: blur(2px);
    }

    .nav-shell {
      width: min(1200px, 94vw);
      margin: 0 auto;
      height: var(--header-h);
      padding: 0 14px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-radius: 18px;
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.07), rgba(255, 255, 255, 0.03));
      border: 1px solid rgba(255, 255, 255, 0.12);
      box-shadow: 0 10px 30px rgba(0, 0, 0, .6);
      position: relative;
      overflow: hidden;
    }

    .nav-shell::before {
      content: "";
      position: absolute;
      inset: -1px;
      background: conic-gradient(from 0deg, #00f0ff, #ff00d4, #00f0ff);
      filter: blur(22px);
      opacity: .14;
      pointer-events: none;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
      text-decoration: none;
      color: #fff;
      min-width: 0;
    }

    .brand img {
      height: 36px;
      width: 36px;
      border-radius: 50%;
      box-shadow: 0 0 8px rgba(255, 255, 255, .1)
    }

    .brand .title {
      font-family: 'Space Grotesk', system-ui, sans-serif;
      font-weight: 800;
      letter-spacing: .02em;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* === Toggle (mobile) === */
    .menu-toggle {
      display: none;
      background: transparent;
      border: 0;
      color: #fff;
      width: 44px;
      height: 44px;
      border-radius: 12px;
    }

    .menu-toggle:focus-visible {
      outline: 2px solid #00f0ff;
      outline-offset: 2px;
    }

    .menu {
      display: flex;
      align-items: center;
      gap: 18px
    }

    .menu a {
      position: relative;
      display: inline-flex;
      align-items: center;
      padding: 10px 10px;
      text-decoration: none;
      color: #fff;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: .08em;
      font-size: 12px;
      opacity: .9;
      transition: opacity .2s ease;
      -webkit-tap-highlight-color: transparent;
    }

    .menu a:hover {
      opacity: 1
    }

    .menu a::after {
      content: "";
      position: absolute;
      left: 12px;
      right: 12px;
      bottom: 6px;
      height: 2px;
      background: linear-gradient(90deg, #00f0ff, #ff00d4);
      transform: scaleX(0);
      transform-origin: left;
      transition: transform .25s ease;
      border-radius: 2px;
    }

    .menu a:hover::after {
      transform: scaleX(1);
    }

    .menu a[aria-current="page"] {
      opacity: 1
    }

    .menu a[aria-current="page"]::after {
      transform: scaleX(1);
    }

    /* User section */
    .user-section {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 6px 12px;
      border-radius: 10px;
      background: rgba(255, 255, 255, .06);
      border: 1px solid rgba(255, 255, 255, .18);
      cursor: pointer;
      transition: transform .15s ease, background .2s ease, border-color .2s ease;
    }

    .user-info:hover {
      transform: translateY(-1px);
      background: rgba(255, 255, 255, .1);
      border-color: rgba(255, 255, 255, .3);
    }

    .user-avatar {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: linear-gradient(135deg, #00f0ff, #ff00d4);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 12px;
    }

    .user-name {
      font-weight: 600;
      font-size: 13px;
    }

    /* Mobile: user section in header */
    @media (max-width: 900px) {
      .user-section #user-display .user-info {
        padding: 4px 8px;
      }

      .user-section #user-display .user-avatar {
        width: 32px;
        height: 32px;
        font-size: 14px;
      }

      .user-section #user-display .user-name {
        display: none;
      }

      .user-section #login-btn {
        padding: 0 12px;
        font-size: 12px;
        height: 36px;
      }
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      height: 32px;
      min-width: 32px;
      padding: 0 10px;
      border-radius: 10px;
      background: rgba(255, 255, 255, .06);
      border: 1px solid rgba(255, 255, 255, .18);
      color: #fff;
      cursor: pointer;
      user-select: none;
      transition: transform .15s ease, background .2s ease, border-color .2s ease;
      text-decoration: none;
      gap: 8px;
      font-family: inherit;
      font-size: 13px;
    }

    .btn:hover {
      transform: translateY(-1px);
      background: rgba(255, 255, 255, .1);
      border-color: rgba(255, 255, 255, .3)
    }

    .btn.primary {
      border: 0;
      background: linear-gradient(90deg, #00f0ff, #ff00d4);
      font-weight: 700;
      box-shadow: 0 8px 24px rgba(0, 0, 0, .35);
    }

    .btn.ghost {
      background: rgba(255, 255, 255, .06);
    }

    /* ===== Hero ===== */
    .hero {
      position: relative;
      min-height: 100svh;
      display: grid;
      place-items: center;
      overflow: hidden;
      padding-top: calc(var(--header-h) + 24px);
      padding-bottom: max(16px, env(safe-area-inset-bottom));
    }

    .bg {
      position: absolute;
      inset: 0;
      background-image: var(--bg-image);
      background-size: cover;
      background-position: center;
      filter: brightness(0.7) saturate(1.1);
      transform: translateZ(0);
    }

    .overlay {
      position: absolute;
      inset: 0;
      background: radial-gradient(80% 60% at 50% 20%, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.65) 60%, rgba(0, 0, 0, 0.85));
    }

    /* T√≠tulo central animado */
    .brand-name {
      position: relative;
      margin: 0 16px;
      text-align: center;
      font-family: 'Space Grotesk', sans-serif;
      font-weight: 800;
      font-size: clamp(36px, 11vw, 120px);
      text-transform: uppercase;
      background: linear-gradient(180deg, #e7f9ff, #bfe4ff 40%, #a6a6a6 60%, #ffffff);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 0 0 20px rgba(255, 255, 255, 0.15);
      animation: fadeZoom 1.5s ease forwards;
      overflow: hidden;
      line-height: 1.05;
    }

    /* Efecto de brillo que cruza */
    .brand-name::after {
      content: "";
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(120deg, transparent 0%, rgba(255, 255, 255, .6) 50%, transparent 100%);
      animation: sheen 4s infinite;
    }

    @keyframes fadeZoom {
      0% {
        opacity: 0;
        transform: scale(0.9);
      }

      100% {
        opacity: 1;
        transform: scale(1);
      }
    }

    @keyframes sheen {
      0% {
        left: -100%;
      }

      40% {
        left: 100%;
      }

      100% {
        left: 100%;
      }
    }

    footer {
      position: absolute;
      bottom: 16px;
      left: 0;
      right: 0;
      text-align: center;
      font-size: 12px;
      opacity: .85;
    }

    /* Modal */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, .65);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      padding: 18px;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .modal-overlay.show {
      display: flex;
      animation: fadeIn 0.3s ease forwards;
    }

    .modal-card {
      width: min(680px, 96vw);
      border-radius: 18px;
      background: radial-gradient(1200px 1200px at -10% -20%, rgba(0, 240, 255, .08), transparent 35%), #111113;
      border: 1px solid rgba(255, 255, 255, .12);
      box-shadow: 0 28px 80px rgba(0, 0, 0, .6), inset 0 1px 0 rgba(255, 255, 255, .06);
      padding: 18px 18px 16px;
      max-height: 90vh;
      overflow-y: auto;
      transform: scale(0.9) translateY(20px);
      opacity: 0;
      transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.3s ease;
    }

    .modal-overlay.show .modal-card {
      transform: scale(1) translateY(0);
      opacity: 1;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }

    .modal-head {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    .modal-title {
      margin: 0;
      font-family: 'Space Grotesk', system-ui, sans-serif;
      font-size: 1.15rem;
      letter-spacing: .2px;
      font-weight: 700;
    }

    .login-form {
      display: flex;
      flex-direction: column;
      gap: 16px;
      margin-top: 20px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .form-group label {
      font-weight: 600;
      font-size: 14px;
    }

    .form-group input {
      padding: 12px 14px;
      border-radius: 10px;
      background: rgba(255, 255, 255, .06);
      border: 1px solid rgba(255, 255, 255, .18);
      color: #fff;
      font-size: 14px;
      font-family: inherit;
      transition: border-color .2s ease, background .2s ease;
    }

    .form-group input:focus {
      outline: none;
      border-color: #00f0ff;
      background: rgba(255, 255, 255, .08);
    }

    .error-msg {
      color: #ff6b6b;
      font-size: 13px;
      margin-top: 4px;
      display: none;
    }

    .error-msg.show {
      display: block;
    }

    .success-msg {
      color: #51cf66;
      font-size: 13px;
      margin-top: 4px;
      display: none;
    }

    .success-msg.show {
      display: block;
    }

    .toggle-form {
      text-align: center;
      margin-top: 16px;
      color: rgba(255, 255, 255, .72);
      font-size: 14px;
    }

    .toggle-form a {
      color: #00f0ff;
      text-decoration: none;
      font-weight: 600;
      transition: opacity .2s ease;
    }

    .toggle-form a:hover {
      opacity: .8
    }

    .modal-actions {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
    }

    /* =========================
       Responsive
       ========================= */
    @media (max-width: 900px) {
      :root {
        --header-h: 56px;
      }

      .brand img {
        width: 32px;
        height: 32px;
      }

      .nav-shell {
        padding: 0 10px;
        border-radius: 14px;
      }

      .menu-toggle {
        display: inline-flex;
        align-items: center;
        justify-content: center;
      }

      .menu {
        position: fixed;
        inset: calc(var(--header-h) + 8px) 8px auto 8px;
        right: 8px;
        left: 8px;
        top: calc(var(--header-h) + 12px);
        display: none;
        flex-direction: column;
        align-items: stretch;
        gap: 6px;
        padding: 10px;
        background: rgba(18, 18, 18, 0.92);
        border: 1px solid rgba(255, 255, 255, 0.12);
        border-radius: 16px;
        box-shadow: 0 20px 50px rgba(0, 0, 0, .6);
        backdrop-filter: blur(8px);
      }

      .menu.open {
        display: flex;
      }

      .menu a {
        padding: 14px 12px;
        font-size: 13px;
        letter-spacing: .12em;
        border-radius: 10px;
      }

      .menu a::after {
        display: none;
      }

      .brand .title {
        font-size: 16px;
      }

      .user-section {
        display: flex;
      }

      .user-section .btn.ghost {
        display: none;
      }
    }

    @media (hover:none) {
      .menu a:hover::after {
        transform: none;
      }

      .menu a:hover {
        opacity: 1;
      }
    }

    /* Accesibilidad: respetar reduce-motion */
    @media (prefers-reduced-motion: reduce) {
      * {
        animation: none !important;
        transition: none !important;
      }
    }
  </style>
</head>

<body>
  <header class="topbar">
    <div class="nav-shell">
      <a class="brand" href="index.html" aria-label="Ir a inicio">
        <img src="logoarriba.jpg" alt="Logo de EsZunSpace">
        <span class="title">EsZunSpace</span>
      </a>

      <!-- Toggle s√≥lo visible en m√≥vil -->
      <button class="menu-toggle" aria-controls="primary-menu" aria-expanded="false" aria-label="Abrir men√∫">
        <svg width="24" height="24" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
          <path d="M3 6h18M3 12h18M3 18h18" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
        </svg>
      </button>

      <nav id="primary-menu" class="menu" role="navigation" aria-label="Men√∫ principal">
        <a href="calendario.html">Calendario</a>
        <a href="cohetes.html">Cohetes</a>
        <a href="motores.html">Motores</a>
        <a href="satelites.html">Sat√©lites</a>
        <a href="lanzamientos.html">Lanzamientos</a>
        <a href="stream.html">Stream</a>
        <div id="mobile-logout-section"
          style="display:none; margin-top:8px; padding-top:8px; border-top:1px solid rgba(255,255,255,.12);">
          <button class="btn ghost" onclick="logout()" style="width:100%; justify-content:center;">Cerrar
            sesi√≥n</button>
        </div>
      </nav>

      <div class="user-section">
        <div id="user-display" style="display:none;">
          <div class="user-info" onclick="showProfileModal()" role="button" tabindex="0" aria-label="Ver perfil">
            <div class="user-avatar" id="user-avatar">U</div>
            <span class="user-name" id="user-name">Usuario</span>
          </div>
          <button class="btn ghost" onclick="logout()">Salir</button>
        </div>
        <button id="login-btn" class="btn primary" onclick="showLoginModal()">Iniciar sesi√≥n</button>
      </div>

      <!-- Botones flotantes de Contacto y Actualizaciones -->
      <button class="secondary-btn secondary-btn-left" onclick="showContactModal()">Contacto</button>
      <button class="secondary-btn secondary-btn-right" onclick="showUpdatesModal()">Actualizaciones</button>
    </div>
  </header>


  <!-- Modal de Actualizaciones -->
  <div id="updates-modal" class="updates-overlay">
    <div class="updates-card">
      <div class="updates-header">
        <h2 class="updates-title">üöÄ Actualizaciones</h2>
        <button class="updates-close" onclick="closeUpdatesModal()" aria-label="Cerrar">&times;</button>
      </div>

      <!-- Formulario para crear actualizaciones (solo visible para Esstor) -->
      <div id="update-admin-form" class="update-admin-form" style="display: none;">
        <h3 class="admin-form-title">‚ûï Nueva Actualizaci√≥n</h3>
        <div class="form-group">
          <input type="text" id="update-title-input" placeholder="üèÜ T√≠tulo de la actualizaci√≥n" class="update-input">
        </div>
        <div class="form-group">
          <textarea id="update-desc-input" placeholder="Descripci√≥n detallada de la actualizaci√≥n..."
            class="update-textarea" rows="5"></textarea>
        </div>
        <div class="form-group">
          <label class="update-label">Imagen (opcional)</label>
          <input type="file" id="update-image-file" accept="image/*" class="update-file-input">
          <input type="hidden" id="update-image-base64">
          <div id="update-image-preview" class="update-image-preview"></div>
        </div>
        <div class="form-row">
          <div class="form-group" style="flex:1;">
            <input type="url" id="update-link-input" placeholder="URL del enlace (opcional)" class="update-input">
          </div>
          <div class="form-group" style="flex:1;">
            <input type="text" id="update-link-text-input" placeholder="Texto del bot√≥n" class="update-input"
              value="Ver m√°s">
          </div>
        </div>
        <button class="btn primary" onclick="createUpdate()">Publicar Actualizaci√≥n</button>
      </div>

      <div class="updates-content" id="updates-list">
        <div class="loading">Cargando actualizaciones...</div>
      </div>
    </div>
  </div>

  <!-- Modal de Detalle de Actualizaci√≥n -->
  <div id="update-detail-modal" class="update-detail-overlay">
    <div class="update-detail-card">
      <button class="update-detail-close" onclick="closeUpdateDetail()" aria-label="Cerrar">&times;</button>
      <div id="update-detail-content">
        <!-- Content will be inserted by JavaScript -->
      </div>
    </div>
  </div>

  <!-- Modal de Contacto / Chat -->
  <div id="contact-modal" class="contact-overlay">
    <div class="contact-card">
      <div class="contact-header">
        <h2 class="contact-title">üí¨ Contacto con EsZunSpace</h2>
        <button class="contact-close" onclick="closeContactModal()" aria-label="Cerrar">&times;</button>
      </div>

      <!-- Vista para usuarios no autenticados -->
      <div id="contact-login-required" class="contact-login-required">
        <div class="contact-login-icon">üîí</div>
        <h3>Inicia sesi√≥n para chatear</h3>
        <p>Necesitas una cuenta para poder enviar mensajes a Esstor y agendar misiones.</p>
        <button class="btn primary" onclick="closeContactModal(); showLoginModal();">Iniciar sesi√≥n</button>
      </div>

      <!-- Vista del chat (solo visible para usuarios autenticados) -->
      <div id="contact-chat" class="contact-chat" style="display:none;">
        <!-- Para Esstor: Lista de conversaciones -->
        <div id="chat-conversations" class="chat-conversations" style="display:none;">
          <h3 class="chat-section-title">üì® Conversaciones</h3>
          <div id="conversations-list" class="conversations-list">
            <!-- Las conversaciones se cargar√°n aqu√≠ -->
          </div>
        </div>

        <!-- √Årea de mensajes -->
        <div id="chat-messages-area" class="chat-messages-area">
          <div id="chat-partner-info" class="chat-partner-info">
            <button id="chat-back-btn" class="chat-back-btn" onclick="backToConversations()" title="Volver">‚Üê</button>
            <span class="chat-partner-avatar">E</span>
            <span class="chat-partner-name">Esstor</span>
            <span class="chat-partner-status">Admin de EsZunSpace</span>
          </div>
          <div id="chat-messages" class="chat-messages">
            <div class="chat-welcome">
              <p>üëã ¬°Hola! Escribe tu mensaje para contactar con Esstor.</p>
              <p class="chat-hint">Puedes agendar misiones, hacer preguntas o solicitar informaci√≥n.</p>
            </div>
          </div>
          <form id="chat-form" class="chat-form" onsubmit="sendChatMessage(event)">
            <input type="text" id="chat-input" placeholder="Escribe tu mensaje..." autocomplete="off" required>
            <button type="submit" class="chat-send-btn">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M22 2L11 13M22 2L15 22L11 13M11 13L2 9L22 2" />
              </svg>
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <style>
    /* Modal de Contacto / Chat */
    .contact-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.75);
      backdrop-filter: blur(8px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10000;
      padding: 20px;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }

    .contact-overlay.show {
      opacity: 1;
      visibility: visible;
    }

    .contact-card {
      width: min(600px, 95vw);
      max-height: 85vh;
      background: linear-gradient(180deg, #161618, #0d0d0f);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 20px;
      box-shadow: 0 25px 80px rgba(0, 0, 0, 0.7);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .contact-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 18px 22px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.08);
      background: rgba(0, 240, 255, 0.03);
    }

    .contact-title {
      margin: 0;
      font-size: 18px;
      font-weight: 700;
    }

    .contact-close {
      background: none;
      border: none;
      color: rgba(255, 255, 255, 0.6);
      font-size: 28px;
      cursor: pointer;
      line-height: 1;
      transition: color 0.2s;
    }

    .contact-close:hover {
      color: #fff;
    }

    /* Login required view */
    .contact-login-required {
      padding: 40px 30px;
      text-align: center;
    }

    .contact-login-icon {
      font-size: 48px;
      margin-bottom: 16px;
    }

    .contact-login-required h3 {
      margin: 0 0 10px;
      font-size: 20px;
    }

    .contact-login-required p {
      color: rgba(255, 255, 255, 0.6);
      margin: 0 0 24px;
      font-size: 14px;
    }

    /* Chat area */
    .contact-chat {
      display: flex;
      flex-direction: column;
      min-height: 350px;
      max-height: 600px;
    }

    .contact-chat.conversations-only {
      min-height: auto;
      max-height: none;
    }

    .chat-conversations {
      max-height: 450px;
      overflow-y: auto;
      background: rgba(0, 0, 0, 0.2);
    }

    .chat-section-title {
      margin: 0;
      padding: 12px 16px;
      font-size: 14px;
      color: rgba(255, 255, 255, 0.7);
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }

    .conversations-list {
      padding: 8px;
    }

    .conversation-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 12px;
      border-radius: 10px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .conversation-item:hover {
      background: rgba(255, 255, 255, 0.05);
    }

    .conversation-item.active {
      background: rgba(0, 240, 255, 0.1);
    }

    .conversation-avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: linear-gradient(135deg, #00e0ff, #ff00d4);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 14px;
    }

    .conversation-info {
      flex: 1;
      min-width: 0;
    }

    .conversation-name {
      font-weight: 600;
      font-size: 14px;
    }

    .conversation-preview {
      font-size: 12px;
      color: rgba(255, 255, 255, 0.5);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .conversation-unread {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #00e0ff;
    }

    .conversation-meta {
      font-size: 11px;
      color: rgba(255, 255, 255, 0.4);
      margin-top: 2px;
    }

    .conversation-actions {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-shrink: 0;
    }

    .conversation-delete {
      background: none;
      border: none;
      cursor: pointer;
      font-size: 14px;
      opacity: 0.4;
      transition: opacity 0.2s, transform 0.2s;
      padding: 4px;
    }

    .conversation-delete:hover {
      opacity: 1;
      transform: scale(1.1);
    }

    .chat-back-btn {
      display: none;
      background: rgba(255, 255, 255, 0.1);
      border: none;
      color: #fff;
      font-size: 18px;
      padding: 6px 12px;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.2s;
      margin-right: 4px;
    }

    .chat-back-btn:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .chat-back-btn.show {
      display: block;
    }

    .conversation-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 14px;
      border-radius: 12px;
      cursor: pointer;
      transition: background 0.2s;
      border: 1px solid transparent;
    }

    .conversation-item:hover {
      background: rgba(255, 255, 255, 0.06);
      border-color: rgba(255, 255, 255, 0.08);
    }

    .conversation-item.active {
      background: rgba(0, 240, 255, 0.12);
      border-color: rgba(0, 240, 255, 0.3);
    }

    .chat-messages-area {
      flex: 1;
      display: flex;
      flex-direction: column;
      min-height: 0;
    }

    .chat-partner-info {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px 16px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.08);
    }

    .chat-partner-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: linear-gradient(135deg, #00e0ff, #ff00d4);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 13px;
    }

    .chat-partner-name {
      font-weight: 700;
      font-size: 14px;
    }

    .chat-partner-status {
      font-size: 12px;
      color: rgba(255, 255, 255, 0.5);
      margin-left: auto;
    }

    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .chat-welcome {
      text-align: center;
      padding: 30px 20px;
      color: rgba(255, 255, 255, 0.6);
    }

    .chat-welcome p {
      margin: 0 0 8px;
    }

    .chat-hint {
      font-size: 13px;
      color: rgba(255, 255, 255, 0.4);
    }

    .chat-message {
      max-width: 80%;
      padding: 10px 14px;
      border-radius: 16px;
      font-size: 14px;
      line-height: 1.4;
    }

    .chat-message.sent {
      align-self: flex-end;
      background: linear-gradient(135deg, #00a8cc, #007acc);
      border-bottom-right-radius: 4px;
    }

    .chat-message.received {
      align-self: flex-start;
      background: rgba(255, 255, 255, 0.1);
      border-bottom-left-radius: 4px;
    }

    .chat-message-time {
      font-size: 10px;
      color: rgba(255, 255, 255, 0.5);
      margin-top: 4px;
    }

    .chat-form {
      display: flex;
      gap: 10px;
      padding: 14px 16px;
      border-top: 1px solid rgba(255, 255, 255, 0.08);
      background: rgba(0, 0, 0, 0.2);
    }

    .chat-form input {
      flex: 1;
      padding: 12px 16px;
      border-radius: 24px;
      background: rgba(255, 255, 255, 0.06);
      border: 1px solid rgba(255, 255, 255, 0.15);
      color: #fff;
      font-size: 14px;
      font-family: inherit;
    }

    .chat-form input:focus {
      outline: none;
      border-color: #00e0ff;
    }

    .chat-send-btn {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background: linear-gradient(135deg, #00e0ff, #ff00d4);
      border: none;
      color: #fff;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .chat-send-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 15px rgba(0, 224, 255, 0.4);
    }
  </style>

  <style>
    /* Botones flotantes en esquinas */
    .secondary-btn {
      position: fixed;
      top: 24px;
      z-index: 1001;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 10px 20px;
      border-radius: 10px;
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.04));
      border: 1px solid rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(10px);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
      color: #fff;
      font-family: 'Space Grotesk', system-ui, sans-serif;
      font-weight: 700;
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      text-decoration: none;
      cursor: pointer;
      transition: transform 0.2s ease, background 0.2s ease, box-shadow 0.2s ease;
    }

    .secondary-btn-left {
      left: 20px;
    }

    .secondary-btn-right {
      right: 20px;
    }

    .secondary-btn:hover {
      transform: translateY(-2px);
      background: linear-gradient(90deg, rgba(0, 240, 255, 0.25), rgba(255, 0, 212, 0.25));
      box-shadow: 0 6px 20px rgba(0, 240, 255, 0.2);
    }

    @media (max-width: 900px) {
      .secondary-btn {
        top: 16px;
        padding: 8px 14px;
        font-size: 11px;
      }

      .secondary-btn-left {
        left: 12px;
      }

      .secondary-btn-right {
        right: 12px;
      }
    }

    /* Modal de Actualizaciones */
    .updates-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.75);
      backdrop-filter: blur(8px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10000;
      padding: 20px;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }

    .updates-overlay.show {
      opacity: 1;
      visibility: visible;
    }

    .updates-card {
      width: min(600px, 95vw);
      max-height: 80vh;
      border-radius: 20px;
      background: linear-gradient(180deg, rgba(20, 20, 25, 0.98), rgba(15, 15, 20, 0.98));
      border: 1px solid rgba(255, 255, 255, 0.15);
      box-shadow: 0 30px 80px rgba(0, 0, 0, 0.7), inset 0 1px 0 rgba(255, 255, 255, 0.08);
      overflow: hidden;
      transform: scale(0.9) translateY(20px);
      transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    .updates-overlay.show .updates-card {
      transform: scale(1) translateY(0);
    }

    .updates-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 20px 24px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      background: linear-gradient(90deg, rgba(0, 240, 255, 0.08), rgba(255, 0, 212, 0.08));
    }

    .updates-title {
      margin: 0;
      font-family: 'Space Grotesk', system-ui, sans-serif;
      font-size: 1.4rem;
      font-weight: 800;
      background: linear-gradient(90deg, #00f0ff, #ff00d4);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .updates-close {
      width: 36px;
      height: 36px;
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.15);
      color: #fff;
      font-size: 24px;
      cursor: pointer;
      transition: background 0.2s ease, transform 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      line-height: 1;
    }

    .updates-close:hover {
      background: rgba(255, 100, 100, 0.2);
      transform: scale(1.05);
    }

    .updates-content {
      padding: 20px 24px;
      overflow-y: auto;
      max-height: calc(80vh - 80px);
    }

    .update-item {
      position: relative;
      padding: 18px;
      margin-bottom: 14px;
      border-radius: 14px;
      background: rgba(255, 255, 255, 0.04);
      border: 1px solid rgba(255, 255, 255, 0.08);
      transition: border-color 0.2s ease, background 0.2s ease;
    }

    .update-item:last-child {
      margin-bottom: 0;
    }

    .update-item:hover {
      background: rgba(255, 255, 255, 0.06);
      border-color: rgba(255, 255, 255, 0.15);
    }

    .update-item.new {
      border-color: rgba(0, 240, 255, 0.3);
      background: linear-gradient(135deg, rgba(0, 240, 255, 0.08), rgba(255, 0, 212, 0.04));
    }

    .update-badge {
      position: absolute;
      top: 12px;
      right: 12px;
      padding: 4px 10px;
      border-radius: 6px;
      background: linear-gradient(90deg, #00f0ff, #ff00d4);
      color: #000;
      font-size: 10px;
      font-weight: 800;
      letter-spacing: 0.05em;
    }

    .update-date {
      font-size: 13px;
      color: #ff4444;
      margin-bottom: 12px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .update-name {
      margin: 0 0 14px;
      font-family: 'Space Grotesk', system-ui, sans-serif;
      font-size: 1.3rem;
      font-weight: 800;
      color: #fff;
      line-height: 1.3;
    }

    .update-desc {
      margin: 0 0 16px;
      font-size: 14px;
      color: rgba(255, 255, 255, 0.75);
      line-height: 1.7;
    }

    .update-image {
      width: 100%;
      max-height: 300px;
      object-fit: cover;
      border-radius: 12px;
      margin: 16px 0;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .update-link-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 12px 28px;
      margin-top: 8px;
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.25);
      color: #fff;
      font-family: 'Space Grotesk', system-ui, sans-serif;
      font-weight: 600;
      font-size: 14px;
      text-decoration: none;
      transition: background 0.2s ease, transform 0.2s ease, border-color 0.2s ease;
    }

    .update-link-btn:hover {
      background: rgba(255, 255, 255, 0.15);
      border-color: rgba(255, 255, 255, 0.4);
      transform: translateY(-2px);
    }

    /* Admin form styles */
    .update-admin-form {
      padding: 20px 24px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      background: rgba(0, 240, 255, 0.03);
    }

    .admin-form-title {
      margin: 0 0 16px;
      font-family: 'Space Grotesk', system-ui, sans-serif;
      font-size: 1.1rem;
      font-weight: 700;
      color: #00f0ff;
    }

    .update-input,
    .update-textarea {
      width: 100%;
      padding: 12px 14px;
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.06);
      border: 1px solid rgba(255, 255, 255, 0.18);
      color: #fff;
      font-size: 14px;
      font-family: inherit;
      transition: border-color .2s ease, background .2s ease;
      resize: vertical;
    }

    .update-input:focus,
    .update-textarea:focus {
      outline: none;
      border-color: #00f0ff;
      background: rgba(255, 255, 255, 0.08);
    }

    .update-textarea {
      min-height: 100px;
    }

    .update-admin-form .form-group {
      margin-bottom: 12px;
    }

    .update-admin-form .form-row {
      display: flex;
      gap: 12px;
    }

    .update-label {
      display: block;
      font-size: 13px;
      font-weight: 600;
      color: rgba(255, 255, 255, 0.8);
      margin-bottom: 8px;
    }

    .update-file-input {
      width: 100%;
      padding: 10px;
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.06);
      border: 1px solid rgba(255, 255, 255, 0.18);
      color: #fff;
      font-size: 13px;
      cursor: pointer;
    }

    .update-file-input::-webkit-file-upload-button {
      background: linear-gradient(90deg, #00f0ff, #ff00d4);
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      color: #000;
      font-weight: 700;
      font-size: 12px;
      cursor: pointer;
      margin-right: 12px;
    }

    .update-image-preview {
      margin-top: 10px;
      height: 120px;
      background-size: cover;
      background-position: center;
      border-radius: 10px;
      display: none;
      border: 1px solid rgba(255, 255, 255, 0.15);
    }

    .update-admin-form .btn.primary {
      width: 100%;
      margin-top: 4px;
    }

    /* Delete button */
    .update-delete-btn {
      position: absolute;
      top: 16px;
      right: 16px;
      width: 32px;
      height: 32px;
      border-radius: 8px;
      background: rgba(255, 80, 80, 0.15);
      border: 1px solid rgba(255, 80, 80, 0.3);
      color: #ff6b6b;
      font-size: 16px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.2s ease, transform 0.2s ease;
      z-index: 5;
    }

    .update-delete-btn:hover {
      background: rgba(255, 80, 80, 0.3);
      transform: scale(1.1);
    }

    .update-item.new .update-badge {
      right: 56px;
    }

    .no-updates {
      text-align: center;
      padding: 40px 20px;
      color: rgba(255, 255, 255, 0.5);
      font-size: 14px;
    }

    @media (max-width: 600px) {
      .update-admin-form .form-row {
        flex-direction: column;
        gap: 0;
      }

      .update-name {
        font-size: 1.1rem;
      }
    }

    /* Modal de Detalle de Actualizaci√≥n */
    .update-detail-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.9);
      backdrop-filter: blur(12px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10001;
      padding: 20px;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }

    .update-detail-overlay.show {
      opacity: 1;
      visibility: visible;
    }

    .update-detail-card {
      position: relative;
      width: min(800px, 95vw);
      max-height: 90vh;
      border-radius: 20px;
      background: linear-gradient(180deg, rgba(20, 20, 25, 0.98), rgba(12, 12, 16, 0.98));
      border: 1px solid rgba(255, 255, 255, 0.12);
      box-shadow: 0 40px 100px rgba(0, 0, 0, 0.8);
      overflow: hidden;
      transform: scale(0.9) translateY(30px);
      transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    .update-detail-overlay.show .update-detail-card {
      transform: scale(1) translateY(0);
    }

    .update-detail-close {
      position: absolute;
      top: 16px;
      right: 16px;
      width: 44px;
      height: 44px;
      border-radius: 12px;
      background: rgba(0, 0, 0, 0.6);
      border: 1px solid rgba(255, 255, 255, 0.2);
      color: #fff;
      font-size: 28px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10;
      transition: background 0.2s ease, transform 0.2s ease;
    }

    .update-detail-close:hover {
      background: rgba(255, 100, 100, 0.3);
      transform: scale(1.05);
    }

    #update-detail-content {
      overflow-y: auto;
      max-height: 90vh;
    }

    .detail-image {
      width: 100%;
      max-height: 400px;
      object-fit: cover;
      display: block;
    }

    .detail-body {
      padding: 30px;
    }

    .detail-date {
      font-size: 14px;
      color: #ff4444;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      margin-bottom: 16px;
    }

    .detail-title {
      margin: 0 0 20px;
      font-family: 'Space Grotesk', system-ui, sans-serif;
      font-size: 2rem;
      font-weight: 800;
      color: #fff;
      line-height: 1.2;
    }

    .detail-description {
      font-size: 16px;
      color: rgba(255, 255, 255, 0.85);
      line-height: 1.8;
      margin-bottom: 24px;
      white-space: pre-wrap;
    }

    .detail-link-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 14px 32px;
      border-radius: 12px;
      background: linear-gradient(90deg, rgba(0, 240, 255, 0.2), rgba(255, 0, 212, 0.2));
      border: 1px solid rgba(255, 255, 255, 0.25);
      color: #fff;
      font-family: 'Space Grotesk', system-ui, sans-serif;
      font-weight: 700;
      font-size: 15px;
      text-decoration: none;
      transition: all 0.2s ease;
    }

    .detail-link-btn:hover {
      background: linear-gradient(90deg, rgba(0, 240, 255, 0.35), rgba(255, 0, 212, 0.35));
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(0, 240, 255, 0.2);
    }

    .update-item {
      cursor: pointer;
    }

    @media (max-width: 600px) {
      .detail-title {
        font-size: 1.5rem;
      }

      .detail-body {
        padding: 20px;
      }

      .detail-image {
        max-height: 250px;
      }
    }
  </style>

  <main class="hero">
    <div class="bg" role="img" aria-label="Fondo espacial"></div>
    <div class="overlay" aria-hidden="true"></div>
    <h1 class="brand-name"></h1>

    <!-- Dynamic Upcoming Launches -->
    <section class="launches-section">
      <div class="launches-container">
        <h2 class="launches-title">Pr√≥ximos Lanzamientos</h2>
        <div id="launches-list" class="launches-list">
          <!-- Launch cards will be inserted here by JavaScript -->
          <div class="loading">Cargando lanzamientos...</div>
        </div>
      </div>
    </section>

    <style>
      /* Launches section */
      .launches-section {
        position: relative;
        z-index: 1;
        width: min(1200px, 92vw);
        margin: 60px auto 80px;
      }

      .launches-container {
        padding: 0;
      }

      .launches-title {
        font-family: 'Space Grotesk', system-ui, sans-serif;
        font-size: clamp(24px, 4vw, 36px);
        font-weight: 800;
        text-transform: uppercase;
        letter-spacing: 0.06em;
        margin: 0 0 24px;
        background: linear-gradient(180deg, #e7f9ff, #bfe4ff 55%, #ffffff);
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
        text-shadow: 0 0 18px rgba(255, 255, 255, 0.15);
      }

      .launches-list {
        display: grid;
        gap: 18px;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      }

      .loading {
        grid-column: 1 / -1;
        text-align: center;
        padding: 40px;
        color: rgba(255, 255, 255, 0.6);
        font-size: 14px;
      }

      /* Launch card */
      .launch-card {
        position: relative;
        padding: 20px;
        border-radius: 18px;
        background: linear-gradient(180deg, rgba(255, 255, 255, 0.06), rgba(255, 255, 255, 0.03));
        border: 1px solid rgba(255, 255, 255, 0.12);
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(8px) saturate(1.1);
        transition: transform 0.25s ease, box-shadow 0.25s ease, border-color 0.25s ease;
        overflow: hidden;
      }

      .launch-card::before {
        content: "";
        position: absolute;
        left: 0;
        right: 0;
        top: 0;
        height: 3px;
        background: linear-gradient(90deg, #00f0ff, #ff00d4);
        opacity: 0.75;
      }

      .launch-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 16px 50px rgba(0, 0, 0, 0.65);
        border-color: rgba(255, 255, 255, 0.22);
      }

      /* Card content */
      .launch-vehicle {
        font-family: 'Space Grotesk', system-ui, sans-serif;
        font-size: 22px;
        font-weight: 900;
        text-transform: uppercase;
        letter-spacing: 0.06em;
        margin-bottom: 6px;
        color: #ffffff;
      }

      .launch-site {
        font-size: 13px;
        color: rgba(255, 255, 255, 0.75);
        margin-bottom: 16px;
        font-weight: 600;
      }

      .launch-mission {
        font-size: 12px;
        color: rgba(255, 255, 255, 0.65);
        margin-bottom: 4px;
        font-style: italic;
      }

      /* Countdown display */
      .launch-countdown {
        margin: 16px 0 12px;
        padding: 14px;
        border-radius: 12px;
        background: linear-gradient(90deg, rgba(0, 240, 255, 0.08), rgba(255, 0, 212, 0.04));
        border: 1px solid rgba(255, 255, 255, 0.08);
        text-align: center;
      }

      .launch-t {
        font-size: 11px;
        font-weight: 700;
        color: #9fdcff;
        margin-bottom: 4px;
        letter-spacing: 0.1em;
      }

      .launch-time {
        font-family: 'Space Grotesk', system-ui, sans-serif;
        font-size: 26px;
        font-weight: 800;
        letter-spacing: 0.02em;
        color: #ffffff;
        line-height: 1;
      }

      /* Launch date */
      .launch-date {
        font-size: 12px;
        color: rgba(255, 255, 255, 0.7);
        font-weight: 600;
        margin-top: 8px;
        text-align: center;
      }

      /* Empty state */
      .no-launches {
        grid-column: 1 / -1;
        text-align: center;
        padding: 60px 20px;
        color: rgba(255, 255, 255, 0.5);
      }

      .no-launches-icon {
        font-size: 48px;
        margin-bottom: 16px;
        opacity: 0.3;
      }

      /* Responsive */
      @media (max-width: 768px) {
        .launches-section {
          margin: 40px auto 60px;
        }

        .launches-list {
          grid-template-columns: 1fr;
        }

        .launch-vehicle {
          font-size: 20px;
        }

        .launch-time {
          font-size: 22px;
        }
      }
    </style>

    <script>
      // Firebase initialization (must be included before this script)
      // Assumes Firebase SDK is already loaded

      (function () {
        const firebaseConfig = {
          apiKey: "AIzaSyDKvGLsd1jKfsSlzgTjBas-8WvbFqV1xU",
          authDomain: "eszunspace-bc900.firebaseapp.com",
          databaseURL: "https://eszunspace-bc900-default-rtdb.europe-west1.firebasedatabase.app",
          projectId: "eszunspace-bc900",
          storageBucket: "eszunspace-bc900.firebasestorage.app",
          messagingSenderId: "105651684829",
          appId: "1:105651684829:web:5c8fd5051c8c2daf24f744",
          measurementId: "G-ZDM5GF0MBW"
        };

        // Initialize Firebase if not already initialized
        if (!firebase.apps.length) {
          firebase.initializeApp(firebaseConfig);
        }
        const database = firebase.database();

        window.upcomingLaunches = [];
        let countdownInterval = null;

        // Load launches from Firebase
        async function loadLaunches() {
          try {
            const snapshot = await database.ref('events').once('value');
            const data = snapshot.val() || {};
            const events = Object.keys(data).map(key => ({ id: key, ...data[key] }));

            // Filter upcoming launches (future dates only)
            const now = new Date();
            upcomingLaunches = events
              .filter(event => new Date(event.datetimeISO) > now)
              .sort((a, b) => new Date(a.datetimeISO) - new Date(b.datetimeISO))
              .slice(0, 6); // Show max 6 launches

            renderLaunches();
            startCountdowns();
          } catch (error) {
            console.error('Error loading launches:', error);
            document.getElementById('launches-list').innerHTML =
              '<div class="no-launches"><div class="no-launches-icon">üöÄ</div><div>Error al cargar lanzamientos</div></div>';
          }
        }

        // Render launch cards
        function renderLaunches() {
          const container = document.getElementById('launches-list');

          if (upcomingLaunches.length === 0) {
            container.innerHTML =
              '<div class="no-launches"><div class="no-launches-icon">üöÄ</div><div>No hay lanzamientos programados</div></div>';
            return;
          }

          container.innerHTML = upcomingLaunches.map(launch => {
            const launchDate = new Date(launch.datetimeISO);
            const dateStr = launchDate.toLocaleString('es-ES', {
              day: 'numeric',
              month: 'short',
              year: 'numeric',
              hour: '2-digit',
              minute: '2-digit',
              timeZoneName: 'short'
            });

            return `
            <div class="launch-card" data-launch-id="${launch.id}" onclick="showEventModal('${launch.id}')" style="cursor:pointer;">
              <div class="launch-vehicle">${launch.vehicle || 'Veh√≠culo'}</div>
              ${launch.mission ? `<div class="launch-mission">${launch.mission}</div>` : ''}
              <div class="launch-site">${launch.site || 'Lugar no especificado'}</div>
              <div class="launch-countdown">
                <div class="launch-t">CUENTA ATR√ÅS</div>
                <div class="launch-time" data-target="${launch.datetimeISO}">--:--:--</div>
              </div>
              <div class="launch-date">${dateStr}</div>
            </div>
          `;
          }).join('');

          // Add click event listeners (alternative approach)
          // Not needed since we use onclick in template
        }

        // Start countdown timers
        function startCountdowns() {
          if (countdownInterval) {
            clearInterval(countdownInterval);
          }

          function update() {
            const now = new Date();
            document.querySelectorAll('.launch-time').forEach(timeEl => {
              const targetStr = timeEl.getAttribute('data-target');
              if (!targetStr) return;

              const target = new Date(targetStr);
              const diff = target - now;

              if (diff <= 0) {
                timeEl.textContent = '¬°LANZADO!';
                timeEl.style.color = '#51cf66';
                return;
              }

              // Calculate time remaining
              const totalSeconds = Math.floor(diff / 1000);
              const days = Math.floor(totalSeconds / 86400);
              const hours = Math.floor((totalSeconds % 86400) / 3600);
              const minutes = Math.floor((totalSeconds % 3600) / 60);
              const seconds = totalSeconds % 60;

              // Format: "Xd HH:MM:SS" or "HH:MM:SS" if < 1 day
              if (days > 0) {
                timeEl.textContent = `${days}d ${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
              } else {
                timeEl.textContent = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
              }
            });
          }

          update();
          countdownInterval = setInterval(update, 1000);
        }

        // Initialize on page load
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', loadLaunches);
        } else {
          loadLaunches();
        }
      })();
    </script>

    <script>
      // Event Modal Functions (global scope for onclick)
      let modalCountdownInterval = null;
      let currentLaunchData = null;

      function showEventModal(launchId) {
        // Find the launch data
        const launch = upcomingLaunches.find(l => l.id === launchId);
        if (!launch) {
          console.error('Launch not found:', launchId);
          return;
        }

        currentLaunchData = launch;

        // Update modal title
        document.getElementById('modal-title').textContent = launch.vehicle || 'Lanzamiento';

        // Update goal pill
        const launchDate = new Date(launch.datetimeISO);
        const dateStr = launchDate.toLocaleString('es-ES', {
          day: 'numeric',
          month: 'long',
          year: 'numeric',
          hour: '2-digit',
          minute: '2-digit',
          timeZoneName: 'short'
        });
        document.getElementById('modal-goal').innerHTML = `
          <span class="goal-dot"></span>
          Ventana objetivo: ${dateStr}
        `;

        // Populate modal info
        let infoHTML = '';
        if (launch.vehicle) {
          infoHTML += `<div class="modal-info-row"><div class="modal-info-label">Veh√≠culo</div><div class="modal-info-value">${launch.vehicle}</div></div>`;
        }
        if (launch.mission) {
          infoHTML += `<div class="modal-info-row"><div class="modal-info-label">Misi√≥n</div><div class="modal-info-value">${launch.mission}</div></div>`;
        }
        if (launch.site) {
          infoHTML += `<div class="modal-info-row"><div class="modal-info-label">Lugar</div><div class="modal-info-value">${launch.site}</div></div>`;
        }
        if (launch.vehicleFull) {
          infoHTML += `<div class="modal-info-row"><div class="modal-info-label">Veh√≠culo Completo</div><div class="modal-info-value">${launch.vehicleFull}</div></div>`;
        }
        if (launch.payload) {
          infoHTML += `<div class="modal-info-row"><div class="modal-info-label">Carga √∫til</div><div class="modal-info-value">${launch.payload}</div></div>`;
        }
        if (launch.orbit) {
          infoHTML += `<div class="modal-info-row"><div class="modal-info-label">√ìrbita objetivo</div><div class="modal-info-value">${launch.orbit}</div></div>`;
        }
        document.getElementById('modal-info').innerHTML = infoHTML;

        // Description
        document.getElementById('modal-desc').textContent = launch.description || 'No hay descripci√≥n disponible.';

        // Stream link
        const watchBtn = document.getElementById('modal-watch');
        if (launch.streamUrl) {
          watchBtn.href = launch.streamUrl;
          watchBtn.style.display = 'inline-flex';
        } else {
          watchBtn.style.display = 'none';
        }

        // Start modal countdown
        const countdownEl = document.getElementById('modal-countdown');
        countdownEl.setAttribute('data-countdown-dt', launch.datetimeISO);

        function updateModalCountdown() {
          const target = new Date(launch.datetimeISO);
          const now = new Date();
          const diff = target - now;

          if (diff <= 0) {
            countdownEl.textContent = '¬°LANZADO!';
            countdownEl.style.color = '#51cf66';
            if (modalCountdownInterval) {
              clearInterval(modalCountdownInterval);
            }
            return;
          }

          const totalSeconds = Math.floor(diff / 1000);
          const days = Math.floor(totalSeconds / 86400);
          const hours = Math.floor((totalSeconds % 86400) / 3600);
          const minutes = Math.floor((totalSeconds % 3600) / 60);
          const seconds = totalSeconds % 60;

          let timeStr = '';
          if (days > 0) {
            timeStr = `T- ${days}d ${String(hours).padStart(2, '0')}h ${String(minutes).padStart(2, '0')}m ${String(seconds).padStart(2, '0')}s`;
          } else if (hours > 0) {
            timeStr = `T- ${String(hours).padStart(2, '0')}h ${String(minutes).padStart(2, '0')}m ${String(seconds).padStart(2, '0')}s`;
          } else {
            timeStr = `T- ${String(minutes).padStart(2, '0')}m ${String(seconds).padStart(2, '0')}s`;
          }
          countdownEl.textContent = timeStr;
        }

        updateModalCountdown();
        if (modalCountdownInterval) {
          clearInterval(modalCountdownInterval);
        }
        modalCountdownInterval = setInterval(updateModalCountdown, 1000);

        // Show modal
        document.getElementById('event-modal-overlay').classList.add('show');
      }

      function closeEventModal() {
        document.getElementById('event-modal-overlay').classList.remove('show');
        if (modalCountdownInterval) {
          clearInterval(modalCountdownInterval);
          modalCountdownInterval = null;
        }
        currentLaunchData = null;
      }

      // Close modal on escape key
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && document.getElementById('event-modal-overlay').classList.contains('show')) {
          closeEventModal();
        }
      });

      // Close modal when clicking outside
      document.getElementById('event-modal-overlay')?.addEventListener('click', (e) => {
        if (e.target.id === 'event-modal-overlay') {
          closeEventModal();
        }
      });
    </script>

    <footer>¬© <span id="year"></span> EsZunSpace ‚Äì Todos los derechos reservados</footer>
  </main>

  <!-- Event Detail Modal -->
  <div id="event-modal-overlay" class="modal-overlay" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal-card" role="document">
      <div class="modal-head">
        <h3 id="modal-title" class="modal-title">Lanzamiento</h3>
        <button class="btn ghost" onclick="closeEventModal()" aria-label="Cerrar">‚úï</button>
      </div>

      <div id="modal-goal" class="goal-pill">
        <span class="goal-dot"></span>
        Ventana objetivo: ‚Äî
      </div>

      <div class="countdown-hero"><span id="modal-countdown" data-countdown-dt=""></span></div>

      <div id="modal-info" class="modal-info"></div>
      <div id="modal-desc" class="modal-desc"></div>

      <div class="timezone-note">La cuenta atr√°s se basa en la hora de <strong>Europa/Madrid</strong>.</div>

      <div class="modal-actions">
        <a id="modal-watch" class="btn primary" href="#" target="_blank" rel="noopener noreferrer"
          style="display:none;">Ver transmisi√≥n</a>
        <button class="btn ghost" onclick="closeEventModal()">Cerrar</button>
      </div>
    </div>
  </div>

  <style>
    /* Event modal styles */
    .goal-pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 14px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.18);
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 16px;
    }

    .goal-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #51cf66;
    }

    .countdown-hero {
      font-family: 'Space Grotesk', system-ui, sans-serif;
      font-size: clamp(32px, 6vw, 56px);
      font-weight: 900;
      text-align: center;
      margin: 20px 0;
      background: linear-gradient(135deg, #00f0ff, #ff00d4);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      letter-spacing: 0.02em;
    }

    .modal-info {
      display: grid;
      gap: 12px;
      margin: 20px 0;
      padding: 16px;
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.04);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .modal-info-row {
      display: flex;
      justify-content: space-between;
      align-items: start;
      gap: 12px;
      padding: 8px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.06);
    }

    .modal-info-row:last-child {
      border-bottom: none;
    }

    .modal-info-label {
      font-size: 13px;
      color: rgba(255, 255, 255, 0.6);
      font-weight: 600;
    }

    .modal-info-value {
      font-size: 14px;
      font-weight: 700;
      text-align: right;
      color: #fff;
    }

    .modal-desc {
      margin: 16px 0;
      padding: 14px;
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.03);
      border-left: 3px solid #00f0ff;
      font-size: 14px;
      line-height: 1.6;
      color: rgba(255, 255, 255, 0.85);
    }

    .timezone-note {
      font-size: 12px;
      color: rgba(255, 255, 255, 0.5);
      text-align: center;
      margin: 16px 0;
    }

    .modal-actions {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
      margin-top: 20px;
    }
  </style>

  <!-- Login/Register Modal -->
  <div id="auth-modal-overlay" class="modal-overlay" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal-card" role="document">
      <div class="modal-head">
        <h3 id="auth-modal-title" class="modal-title">Iniciar sesi√≥n</h3>
        <button class="btn ghost" onclick="closeAuthModal()" aria-label="Cerrar">‚úï</button>
      </div>

      <!-- Login Form -->
      <form id="login-form" class="login-form" onsubmit="handleLogin(event)">
        <div class="form-group">
          <label for="login-username">Usuario</label>
          <input type="text" id="login-username" name="username" required autocomplete="username">
        </div>
        <div class="form-group">
          <label for="login-password">Contrase√±a</label>
          <input type="password" id="login-password" name="password" required autocomplete="current-password">
          <div id="login-error" class="error-msg">Usuario o contrase√±a incorrectos</div>
        </div>
        <div class="modal-actions">
          <button type="submit" class="btn primary">Entrar</button>
          <button type="button" class="btn ghost" onclick="closeAuthModal()">Cancelar</button>
        </div>
        <div class="toggle-form">
          ¬øNo tienes cuenta? <span class="text-link" onclick="showRegisterForm()"
            style="cursor:pointer; color:var(--primary-color);">Crear cuenta</span>
        </div>
      </form>

      <!-- Register Form -->
      <form id="register-form" class="login-form" style="display:none;" onsubmit="handleRegister(event)">
        <div class="form-group">
          <label for="register-username">Usuario</label>
          <input type="text" id="register-username" name="username" required autocomplete="username">
        </div>
        <div class="form-group">
          <label for="register-password">Contrase√±a</label>
          <input type="password" id="register-password" name="password" required autocomplete="new-password"
            minlength="6">
          <div id="register-error" class="error-msg">Error al crear la cuenta</div>
          <div id="register-success" class="success-msg">¬°Cuenta creada! Iniciando sesi√≥n...</div>
        </div>
        <div class="modal-actions">
          <button type="submit" class="btn primary">Crear cuenta</button>
          <button type="button" class="btn ghost" onclick="closeAuthModal()">Cancelar</button>
        </div>
        <div class="toggle-form">
          ¬øYa tienes cuenta? <span class="text-link" onclick="showLoginForm(event)"
            style="cursor:pointer; color:var(--primary-color);">Iniciar sesi√≥n</span>
        </div>
      </form>
    </div>
  </div>

  <!-- Profile Modal -->
  <div id="profile-modal-overlay" class="modal-overlay" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal-card" role="document">
      <div class="modal-head">
        <h3 class="modal-title">Mi Perfil</h3>
        <button class="btn ghost" onclick="closeProfileModal()" aria-label="Cerrar">‚úï</button>
      </div>

      <div style="margin-top:20px;">
        <div class="user-info" style="justify-content:center; padding:16px; cursor:default;">
          <div class="user-avatar" id="profile-avatar" style="width:48px; height:48px; font-size:20px;">U</div>
          <span class="user-name" id="profile-username" style="font-size:18px;">Usuario</span>
        </div>

        <!-- Change Username Form -->
        <form id="change-username-form" class="login-form" style="margin-top:24px;"
          onsubmit="handleChangeUsername(event)">
          <div class="form-group">
            <label for="new-username">Nuevo nombre de usuario</label>
            <input type="text" id="new-username" name="username" required autocomplete="username">
            <div id="username-change-error" class="error-msg">Este nombre de usuario ya est√° en uso</div>
            <div id="username-change-success" class="success-msg">¬°Nombre de usuario actualizado!</div>
          </div>
          <div class="modal-actions">
            <button type="submit" class="btn primary">Cambiar nombre</button>
          </div>
        </form>

        <!-- Change Password Form -->
        <form id="change-password-form" class="login-form" style="margin-top:16px;"
          onsubmit="handleChangePassword(event)">
          <div class="form-group">
            <label for="current-password">Contrase√±a actual</label>
            <input type="password" id="current-password" name="current-password" required
              autocomplete="current-password">
          </div>
          <div class="form-group">
            <label for="new-password">Nueva contrase√±a</label>
            <input type="password" id="new-password" name="new-password" required autocomplete="new-password"
              minlength="6">
            <div id="password-change-error" class="error-msg">Contrase√±a actual incorrecta</div>
            <div id="password-change-success" class="success-msg">¬°Contrase√±a actualizada!</div>
          </div>
          <div class="modal-actions">
            <button type="submit" class="btn primary">Cambiar contrase√±a</button>
          </div>
        </form>

        <div style="margin-top:24px; padding-top:16px; border-top:1px solid rgba(255,255,255,.12);">
          <button class="btn ghost" onclick="deleteAccount()" style="color:#ff6b6b; width:100%;">Eliminar
            cuenta</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ===== CONFIGURACI√ìN DE FIREBASE =====
    const firebaseConfig = {
      apiKey: "AIzaSyDKvGLsd1jKfsSlzgTjBas-8WvbFqV1xU",
      authDomain: "eszunspace-bc900.firebaseapp.com",
      databaseURL: "https://eszunspace-bc900-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "eszunspace-bc900",
      storageBucket: "eszunspace-bc900.firebasestorage.app",
      messagingSenderId: "105651684829",
      appId: "1:105651684829:web:5c8fd5051c8c2daf24f744",
      measurementId: "G-ZDM5GF0MBW"
    };

    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // ===== SHA-256 HASHING HELPER =====
    async function hashPassword(message) {
      const msgBuffer = new TextEncoder().encode(message);
      const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
      const hashArray = Array.from(new Uint8Array(hashBuffer));
      const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
      return hashHex;
    }

    // ===== AUTH SYSTEM (RTDB) =====
    let currentUser = null;
    let allUsers = {};
    const SESSION_KEY = 'esz_user';

    async function loadUsers() {
      try {
        const snapshot = await database.ref('users').once('value');
        allUsers = snapshot.val() || {};
        console.log("Usuarios cargados:", Object.keys(allUsers).length);
      } catch (error) {
        console.error('Error al cargar usuarios:', error);
        allUsers = {};
      }
    }

    function hydrateSessionFromStorage() {
      const saved = localStorage.getItem(SESSION_KEY);
      currentUser = (saved && saved.trim()) ? saved : null;
      checkAuth();
    }

    function checkAuth() {
      if (currentUser) {
        document.getElementById('login-btn').style.display = 'none';
        document.getElementById('user-display').style.display = 'flex';
        document.getElementById('user-name').textContent = currentUser;
        document.getElementById('user-avatar').textContent = currentUser.charAt(0).toUpperCase();
      } else {
        document.getElementById('login-btn').style.display = 'inline-flex';
        document.getElementById('user-display').style.display = 'none';
      }
    }

    // Keep multiple tabs/pages in sync
    window.addEventListener('storage', (e) => {
      if (e.key === SESSION_KEY) {
        hydrateSessionFromStorage();
      }
    });

    async function saveUser(username, password) {
      try {
        // Double check against DB to be sure
        const snapshot = await database.ref('users/' + username).once('value');
        if (snapshot.exists()) {
          return false; // Already exists
        }

        // Save password as plain text
        await database.ref('users/' + username).set(password);
        allUsers[username] = password;
        return true;
      } catch (error) {
        console.error('Error al guardar usuario:', error);
        return false;
      }
    }

    // ===== UI FUNCTIONS =====
    function showLoginModal() {
      showLoginForm();
      const modal = document.getElementById('auth-modal-overlay');
      modal.style.display = 'flex';
      requestAnimationFrame(() => {
        modal.classList.add('show');
      });
    }

    function closeAuthModal() {
      const modal = document.getElementById('auth-modal-overlay');
      modal.classList.remove('show');
      setTimeout(() => {
        modal.style.display = 'none';
      }, 300);
      document.getElementById('login-error').classList.remove('show');
      document.getElementById('register-error').classList.remove('show');
      document.getElementById('register-success').classList.remove('show');
    }

    function showLoginForm(e) {
      if (e) e.preventDefault();
      document.getElementById('auth-modal-title').textContent = 'Iniciar sesi√≥n';
      document.getElementById('login-form').style.display = 'flex';
      document.getElementById('register-form').style.display = 'none';
      document.getElementById('login-username').value = '';
      document.getElementById('login-password').value = '';
      document.getElementById('login-error').classList.remove('show');
    }

    function showRegisterForm(e) {
      if (e) e.preventDefault();
      document.getElementById('auth-modal-title').textContent = 'Crear cuenta';
      document.getElementById('login-form').style.display = 'none';
      document.getElementById('register-form').style.display = 'flex';
      document.getElementById('register-username').value = '';
      document.getElementById('register-password').value = '';
      document.getElementById('register-error').classList.remove('show');
      document.getElementById('register-success').classList.remove('show');
    }

    // ===== HANDLERS =====

    async function handleLogin(e) {
      e.preventDefault();
      const username = document.getElementById('login-username').value.trim();
      const password = document.getElementById('login-password').value;
      const errEl = document.getElementById('login-error');

      if (!allUsers[username]) {
        errEl.textContent = 'Usuario no encontrado';
        errEl.classList.add('show');
        return;
      }

      const storedPassword = allUsers[username];

      // Compare passwords directly
      if (storedPassword === password) {
        currentUser = username;
        localStorage.setItem(SESSION_KEY, currentUser);
        checkAuth();
        closeAuthModal();
      } else {
        errEl.textContent = 'Contrase√±a incorrecta';
        errEl.classList.add('show');
      }
    }

    async function handleRegister(e) {
      e.preventDefault();
      const username = document.getElementById('register-username').value.trim();
      const password = document.getElementById('register-password').value;

      document.getElementById('register-error').classList.remove('show');
      document.getElementById('register-success').classList.remove('show');

      if (allUsers[username]) {
        const err = document.getElementById('register-error');
        err.textContent = 'Este usuario ya existe';
        err.classList.add('show');
        return;
      }

      const success = await saveUser(username, password);

      if (success) {
        document.getElementById('register-success').classList.add('show');
        setTimeout(() => {
          currentUser = username;
          localStorage.setItem(SESSION_KEY, currentUser);
          checkAuth();
          closeAuthModal();
        }, 1500);
      } else {
        const err = document.getElementById('register-error');
        err.textContent = 'Error al crear cuenta. Intenta otro nombre.';
        err.classList.add('show');
      }
    }

    function logout() {
      currentUser = null;
      localStorage.removeItem(SESSION_KEY);
      checkAuth();
    }

    function getFirebaseErrorMessage(code) {
      return code;
    }

    // ===== PROFILE FUNCTIONS (Re-implemented for Custom Auth) =====
    function showProfileModal() {
      if (!currentUser) return;
      document.getElementById('profile-username').textContent = currentUser;
      document.getElementById('profile-avatar').textContent = currentUser.charAt(0).toUpperCase();
      document.getElementById('new-username').value = '';
      document.getElementById('current-password').value = '';
      document.getElementById('new-password').value = '';

      // Clear messages
      document.getElementById('username-change-error').classList.remove('show');
      document.getElementById('username-change-success').classList.remove('show');
      document.getElementById('password-change-error').classList.remove('show');
      document.getElementById('password-change-success').classList.remove('show');

      const modal = document.getElementById('profile-modal-overlay');
      modal.style.display = 'flex';
      requestAnimationFrame(() => {
        modal.classList.add('show');
      });
    }

    function closeProfileModal() {
      const modal = document.getElementById('profile-modal-overlay');
      modal.classList.remove('show');
      setTimeout(() => {
        modal.style.display = 'none';
      }, 300);
    }

    async function handleChangeUsername(e) {
      e.preventDefault();
      const newUsername = document.getElementById('new-username').value.trim();

      const err = document.getElementById('username-change-error');
      err.classList.remove('show');

      if (newUsername === currentUser) {
        err.textContent = 'El nombre es el mismo';
        err.classList.add('show');
        return;
      }

      if (allUsers[newUsername]) {
        err.textContent = 'Este usuario ya est√° en uso';
        err.classList.add('show');
        return;
      }

      try {
        const passwordHash = allUsers[currentUser];

        // Remove old
        await database.ref('users/' + currentUser).remove();
        delete allUsers[currentUser];

        // Add new
        await database.ref('users/' + newUsername).set(passwordHash);
        allUsers[newUsername] = passwordHash;

        // Update session
        currentUser = newUsername;
        localStorage.setItem(SESSION_KEY, currentUser);

        document.getElementById('username-change-success').classList.add('show');
        document.getElementById('profile-username').textContent = newUsername;
        document.getElementById('user-name').textContent = newUsername;

        setTimeout(() => {
          closeProfileModal();
        }, 1500);
      } catch (error) {
        console.error('Error al cambiar nombre:', error);
        err.textContent = 'Error al procesar la solicitud';
        err.classList.add('show');
      }
    }

    async function handleChangePassword(e) {
      e.preventDefault();
      const newPassword = document.getElementById('new-password').value;
      const hashedNew = await hashPassword(newPassword);

      try {
        await database.ref('users/' + currentUser).set(hashedNew);
        allUsers[currentUser] = hashedNew;

        document.getElementById('password-change-success').classList.add('show');
        document.getElementById('new-password').value = '';
        setTimeout(() => {
          document.getElementById('password-change-success').classList.remove('show');
        }, 3000);
      } catch (error) {
        console.error('Error al cambiar contrase√±a:', error);
        document.getElementById('password-change-error').textContent = 'Error al cambiar contrase√±a';
        document.getElementById('password-change-error').classList.add('show');
      }
    }

    async function deleteAccount() {
      if (!confirm('¬øEst√°s seguro?')) return;

      try {
        await database.ref('users/' + currentUser).remove();
        delete allUsers[currentUser];
        logout();
        closeProfileModal();
        alert('Cuenta eliminada');
      } catch (error) {
        alert('Error al eliminar');
      }
    }

    // Modal de Actualizaciones
    const ADMIN_USER = 'Esstor';
    let updatesData = [];

    // ===== CONTACT CHAT SYSTEM =====
    let currentChatPartner = null;
    let chatUnsubscribe = null;

    function showContactModal() {
      const modal = document.getElementById('contact-modal');
      modal.classList.add('show');
      document.body.style.overflow = 'hidden';

      // Verificar si hay usuario logueado
      if (currentUser) {
        document.getElementById('contact-login-required').style.display = 'none';
        document.getElementById('contact-chat').style.display = 'flex';

        // Si es Esstor, mostrar lista de conversaciones
        if (currentUser === ADMIN_USER) {
          document.getElementById('chat-conversations').style.display = 'block';
          document.getElementById('chat-partner-info').style.display = 'none';
          document.getElementById('chat-messages-area').style.display = 'none'; // Ocultar hasta seleccionar chat
          document.getElementById('contact-chat').classList.add('conversations-only');
          currentChatPartner = null;
          loadConversations();
        } else {
          // Usuario normal: chat directo con Esstor
          document.getElementById('chat-conversations').style.display = 'none';
          document.getElementById('chat-partner-info').style.display = 'flex';
          document.getElementById('chat-messages-area').style.display = 'flex';
          document.getElementById('contact-chat').classList.remove('conversations-only');
          currentChatPartner = ADMIN_USER;
          loadChatMessages(currentUser, ADMIN_USER);
        }
      } else {
        document.getElementById('contact-login-required').style.display = 'block';
        document.getElementById('contact-chat').style.display = 'none';
      }
    }

    function closeContactModal() {
      document.getElementById('contact-modal').classList.remove('show');
      document.body.style.overflow = '';
      if (chatUnsubscribe) {
        chatUnsubscribe();
        chatUnsubscribe = null;
      }
    }

    // Cargar lista de conversaciones para Esstor
    async function loadConversations() {
      const list = document.getElementById('conversations-list');
      list.innerHTML = '<div style="padding:20px; text-align:center; color:rgba(255,255,255,0.5);">Cargando conversaciones...</div>';

      try {
        const snapshot = await database.ref('chats').once('value');
        const chats = snapshot.val() || {};
        const conversationUsers = Object.keys(chats);

        if (conversationUsers.length === 0) {
          list.innerHTML = '<div style="padding:20px; text-align:center; color:rgba(255,255,255,0.5);">No hay conversaciones a√∫n.</div>';
          return;
        }

        list.innerHTML = '';
        for (const username of conversationUsers) {
          const messagesSnap = await database.ref(`chats/${username}`).orderByChild('timestamp').once('value');
          let lastMessage = '';
          let lastTime = null;
          let hasUnread = false;
          let messageCount = 0;

          messagesSnap.forEach(msg => {
            const data = msg.val();
            lastMessage = data.text || '';
            lastTime = data.timestamp;
            messageCount++;
            if (data.from !== ADMIN_USER && !data.read) {
              hasUnread = true;
            }
          });

          const timeStr = lastTime ? new Date(lastTime).toLocaleDateString('es-ES', { day: '2-digit', month: 'short', hour: '2-digit', minute: '2-digit' }) : '';

          const item = document.createElement('div');
          item.className = 'conversation-item' + (currentChatPartner === username ? ' active' : '');
          item.innerHTML = `
            <span class="conversation-avatar">${username.charAt(0).toUpperCase()}</span>
            <div class="conversation-info">
              <div class="conversation-name">${username}</div>
              <div class="conversation-preview">${lastMessage.substring(0, 25)}${lastMessage.length > 25 ? '...' : ''}</div>
              <div class="conversation-meta">${messageCount} mensaje${messageCount !== 1 ? 's' : ''} ¬∑ ${timeStr}</div>
            </div>
            <div class="conversation-actions">
              ${hasUnread ? '<span class="conversation-unread"></span>' : ''}
              <button class="conversation-delete" onclick="event.stopPropagation(); deleteConversation('${username}')" title="Eliminar chat">üóëÔ∏è</button>
            </div>
          `;
          item.onclick = () => selectConversation(username);
          list.appendChild(item);
        }
      } catch (error) {
        console.error('Error loading conversations:', error);
        list.innerHTML = '<div style="padding:20px; text-align:center; color:#ff6b6b;">Error al cargar conversaciones</div>';
      }
    }

    async function deleteConversation(username) {
      if (!confirm(`¬øEliminar la conversaci√≥n con ${username}? Esta acci√≥n no se puede deshacer.`)) {
        return;
      }

      try {
        await database.ref(`chats/${username}`).remove();

        // Si era la conversaci√≥n activa, limpiar la vista
        if (currentChatPartner === username) {
          currentChatPartner = null;
          document.getElementById('chat-messages').innerHTML = `
            <div class="chat-welcome">
              <p>Selecciona una conversaci√≥n para ver los mensajes.</p>
            </div>
          `;
          document.getElementById('chat-partner-info').style.display = 'none';
          document.getElementById('chat-messages-area').style.display = 'none';
          document.getElementById('contact-chat').classList.add('conversations-only');
        }

        loadConversations();
      } catch (error) {
        console.error('Error deleting conversation:', error);
        alert('Error al eliminar la conversaci√≥n');
      }
    }

    function selectConversation(username) {
      currentChatPartner = username;

      // Ocultar lista de conversaciones y mostrar chat
      document.getElementById('chat-conversations').style.display = 'none';
      document.getElementById('chat-partner-info').style.display = 'flex';
      document.getElementById('chat-messages-area').style.display = 'flex';
      document.getElementById('contact-chat').classList.remove('conversations-only');

      // Mostrar bot√≥n de volver solo para Esstor
      if (currentUser === ADMIN_USER) {
        document.getElementById('chat-back-btn').classList.add('show');
      }

      document.querySelector('.chat-partner-avatar').textContent = username.charAt(0).toUpperCase();
      document.querySelector('.chat-partner-name').textContent = username;
      document.querySelector('.chat-partner-status').textContent = 'Usuario';

      loadChatMessages(username, ADMIN_USER);
    }

    function backToConversations() {
      // Ocultar chat y mostrar lista de conversaciones
      document.getElementById('chat-conversations').style.display = 'block';
      document.getElementById('chat-partner-info').style.display = 'none';
      document.getElementById('chat-messages-area').style.display = 'none';
      document.getElementById('contact-chat').classList.add('conversations-only');
      document.getElementById('chat-back-btn').classList.remove('show');

      // Desuscribir del chat actual
      if (chatUnsubscribe) {
        chatUnsubscribe();
        chatUnsubscribe = null;
      }

      currentChatPartner = null;
      loadConversations();
    }

    function loadChatMessages(username, partner) {
      const container = document.getElementById('chat-messages');
      container.innerHTML = '<div class="chat-welcome"><p>Cargando mensajes...</p></div>';

      // Desuscribir listener anterior
      if (chatUnsubscribe) {
        chatUnsubscribe();
      }

      // La ruta del chat es siempre por el nombre del usuario normal (no Esstor)
      const chatPath = currentUser === ADMIN_USER ? username : currentUser;

      const ref = database.ref(`chats/${chatPath}`).orderByChild('timestamp');

      const listener = ref.on('value', (snapshot) => {
        const messages = [];
        snapshot.forEach(child => {
          messages.push({ id: child.key, ...child.val() });
        });

        if (messages.length === 0) {
          container.innerHTML = `
            <div class="chat-welcome">
              <p>üëã ¬°Hola! Escribe tu mensaje para contactar con ${currentUser === ADMIN_USER ? username : 'Esstor'}.</p>
              <p class="chat-hint">Puedes agendar misiones, hacer preguntas o solicitar informaci√≥n.</p>
            </div>
          `;
          return;
        }

        container.innerHTML = '';
        messages.forEach(msg => {
          const isSent = msg.from === currentUser;
          const msgEl = document.createElement('div');
          msgEl.className = `chat-message ${isSent ? 'sent' : 'received'}`;

          const time = new Date(msg.timestamp).toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' });
          msgEl.innerHTML = `
            <div>${msg.text}</div>
            <div class="chat-message-time">${time}</div>
          `;
          container.appendChild(msgEl);

          // Marcar como le√≠do si es para el usuario actual
          if (!isSent && !msg.read) {
            database.ref(`chats/${chatPath}/${msg.id}`).update({ read: true });
          }
        });

        // Scroll to bottom
        container.scrollTop = container.scrollHeight;
      });

      chatUnsubscribe = () => ref.off('value', listener);
    }

    async function sendChatMessage(e) {
      e.preventDefault();
      const input = document.getElementById('chat-input');
      const text = input.value.trim();

      if (!text || !currentUser) return;

      // Determinar la ruta del chat
      const chatPath = currentUser === ADMIN_USER ? currentChatPartner : currentUser;

      if (!chatPath) {
        alert('Selecciona una conversaci√≥n primero');
        return;
      }

      const message = {
        from: currentUser,
        to: currentUser === ADMIN_USER ? currentChatPartner : ADMIN_USER,
        text: text,
        timestamp: Date.now(),
        read: false
      };

      try {
        await database.ref(`chats/${chatPath}`).push(message);
        input.value = '';

        // Si Esstor est√° respondiendo, actualizar la lista de conversaciones
        if (currentUser === ADMIN_USER) {
          loadConversations();
        }
      } catch (error) {
        console.error('Error sending message:', error);
        alert('Error al enviar el mensaje');
      }
    }

    // Cerrar modal al hacer clic fuera
    document.getElementById('contact-modal')?.addEventListener('click', (e) => {
      if (e.target.id === 'contact-modal') {
        closeContactModal();
      }
    });

    function showUpdatesModal() {
      document.getElementById('updates-modal').classList.add('show');
      document.body.style.overflow = 'hidden';

      // Mostrar formulario de admin si es Esstor
      const adminForm = document.getElementById('update-admin-form');
      if (currentUser === ADMIN_USER) {
        adminForm.style.display = 'block';
      } else {
        adminForm.style.display = 'none';
      }

      loadUpdates();
    }

    function closeUpdatesModal() {
      document.getElementById('updates-modal').classList.remove('show');
      document.body.style.overflow = '';
    }

    async function loadUpdates() {
      const container = document.getElementById('updates-list');
      container.innerHTML = '<div class="loading">Cargando actualizaciones...</div>';

      try {
        const snapshot = await database.ref('updates').orderByChild('timestamp').once('value');
        updatesData = [];

        snapshot.forEach((child) => {
          updatesData.push({
            id: child.key,
            ...child.val()
          });
        });

        // Ordenar de m√°s reciente a m√°s antiguo
        updatesData.reverse();

        renderUpdates();
      } catch (error) {
        console.error('Error cargando actualizaciones:', error);
        container.innerHTML = '<div class="no-updates">Error al cargar actualizaciones</div>';
      }
    }

    function renderUpdates() {
      const container = document.getElementById('updates-list');
      const isAdmin = currentUser === ADMIN_USER;

      if (updatesData.length === 0) {
        container.innerHTML = '<div class="no-updates">No hay actualizaciones disponibles</div>';
        return;
      }

      const now = Date.now();
      const threeDays = 3 * 24 * 60 * 60 * 1000; // 3 d√≠as en ms

      container.innerHTML = updatesData.map((update, index) => {
        const isNew = (now - update.timestamp) < threeDays;
        const date = new Date(update.timestamp);
        const dateStr = date.toLocaleDateString('es-ES', { day: 'numeric', month: 'long', year: 'numeric' }).toUpperCase();

        // Truncar descripci√≥n en la lista
        const shortDesc = update.description.length > 150 ?
          update.description.substring(0, 150) + '...' : update.description;

        const imageHtml = update.imageUrl ?
          `<img src="${escapeHtml(update.imageUrl)}" alt="" class="update-image" loading="lazy">` : '';

        return `
          <div class="update-item ${isNew ? 'new' : ''}" onclick="openUpdateDetail(${index})" data-index="${index}">
            ${isNew ? '<div class="update-badge">NUEVO</div>' : ''}
            ${isAdmin ? `<button class="update-delete-btn" onclick="event.stopPropagation(); deleteUpdate('${update.id}')" title="Eliminar">üóë</button>` : ''}
            <div class="update-date">${dateStr}</div>
            <h3 class="update-name">${escapeHtml(update.title)}</h3>
            <p class="update-desc">${escapeHtml(shortDesc)}</p>
            ${imageHtml}
          </div>
        `;
      }).join('');
    }

    function openUpdateDetail(index) {
      const update = updatesData[index];
      if (!update) return;

      const date = new Date(update.timestamp);
      const dateStr = date.toLocaleDateString('es-ES', { day: 'numeric', month: 'long', year: 'numeric' }).toUpperCase();

      const imageHtml = update.imageUrl ?
        `<img src="${update.imageUrl}" alt="" class="detail-image">` : '';

      const linkHtml = update.linkUrl ?
        `<a href="${escapeHtml(update.linkUrl)}" class="detail-link-btn" target="_blank" rel="noopener">${escapeHtml(update.linkText || 'Ver m√°s')}</a>` : '';

      const content = `
        ${imageHtml}
        <div class="detail-body">
          <div class="detail-date">${dateStr}</div>
          <h2 class="detail-title">${escapeHtml(update.title)}</h2>
          <p class="detail-description">${escapeHtml(update.description)}</p>
          ${linkHtml}
        </div>
      `;

      document.getElementById('update-detail-content').innerHTML = content;
      document.getElementById('update-detail-modal').classList.add('show');
    }

    function closeUpdateDetail() {
      document.getElementById('update-detail-modal').classList.remove('show');
    }

    // Cerrar modal de detalle con click fuera o Escape
    document.getElementById('update-detail-modal')?.addEventListener('click', (e) => {
      if (e.target.id === 'update-detail-modal') {
        closeUpdateDetail();
      }
    });

    function escapeHtml(text) {
      if (!text) return '';
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    async function createUpdate() {
      if (currentUser !== ADMIN_USER) {
        alert('No tienes permisos para crear actualizaciones');
        return;
      }

      const title = document.getElementById('update-title-input').value.trim();
      const description = document.getElementById('update-desc-input').value.trim();
      const imageBase64 = document.getElementById('update-image-base64').value;
      const linkUrl = document.getElementById('update-link-input').value.trim();
      const linkText = document.getElementById('update-link-text-input').value.trim();

      if (!title || !description) {
        alert('Por favor, completa el t√≠tulo y la descripci√≥n');
        return;
      }

      try {
        const newUpdate = {
          title: title,
          description: description,
          timestamp: Date.now(),
          author: ADMIN_USER
        };

        // A√±adir campos opcionales solo si tienen valor
        if (imageBase64) newUpdate.imageUrl = imageBase64;
        if (linkUrl) {
          newUpdate.linkUrl = linkUrl;
          newUpdate.linkText = linkText || 'Ver m√°s';
        }

        await database.ref('updates').push(newUpdate);

        // Limpiar formulario
        document.getElementById('update-title-input').value = '';
        document.getElementById('update-desc-input').value = '';
        document.getElementById('update-image-file').value = '';
        document.getElementById('update-image-base64').value = '';
        document.getElementById('update-image-preview').style.display = 'none';
        document.getElementById('update-link-input').value = '';
        document.getElementById('update-link-text-input').value = 'Ver m√°s';

        // Recargar lista
        loadUpdates();
      } catch (error) {
        console.error('Error creando actualizaci√≥n:', error);
        alert('Error al crear la actualizaci√≥n');
      }
    }

    async function deleteUpdate(updateId) {
      if (currentUser !== ADMIN_USER) {
        alert('No tienes permisos para eliminar actualizaciones');
        return;
      }

      if (!confirm('¬øEst√°s seguro de que quieres eliminar esta actualizaci√≥n?')) {
        return;
      }

      try {
        await database.ref('updates/' + updateId).remove();
        loadUpdates();
      } catch (error) {
        console.error('Error eliminando actualizaci√≥n:', error);
        alert('Error al eliminar la actualizaci√≥n');
      }
    }

    // Cerrar modal con Escape o click fuera
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        closeUpdateDetail();
        closeUpdatesModal();
      }
    });

    document.getElementById('updates-modal')?.addEventListener('click', (e) => {
      if (e.target.id === 'updates-modal') {
        closeUpdatesModal();
      }
    });

    document.addEventListener("DOMContentLoaded", async () => {
      document.body.classList.add("fade-in");
      document.getElementById("year").textContent = new Date().getFullYear();

      // INITIALIZE CUSTOM AUTH
      await loadUsers();
      hydrateSessionFromStorage();

      // Image upload handler for updates
      const updateImageInput = document.getElementById('update-image-file');
      if (updateImageInput) {
        updateImageInput.addEventListener('change', function (e) {
          const file = e.target.files[0];
          if (!file) return;

          if (file.size > 2 * 1024 * 1024) { // 2MB limit
            alert('La imagen es muy grande. Se recomienda menos de 2MB.');
          }

          const reader = new FileReader();
          reader.onloadend = function () {
            const base64 = reader.result;
            document.getElementById('update-image-base64').value = base64;
            const preview = document.getElementById('update-image-preview');
            preview.style.backgroundImage = `url('${base64}')`;
            preview.style.display = 'block';
          };
          reader.readAsDataURL(file);
        });
      }

      const path = location.pathname.split("/").pop() || "index.html";
      document.querySelectorAll(".menu a").forEach(a => {
        const href = a.getAttribute("href");
        if ((path === "" && href === "index.html") || href === path) {
          a.setAttribute("aria-current", "page");
        }
      });

      // Transici√≥n suave entre p√°ginas internas
      document.querySelectorAll('a[href]').forEach(link => {
        const url = new URL(link.href, location.href);
        if (url.origin === location.origin && !link.target) {
          link.addEventListener("click", e => {
            if (url.pathname === location.pathname && url.hash) return;
            const menu = document.querySelector('.menu');
            if (menu && menu.classList.contains('open')) return;
            e.preventDefault();
            document.body.classList.add("fade-out");
            setTimeout(() => location.href = url.href, 600);
          });
        }
      });

      // Toggle del men√∫ en m√≥vil
      const toggle = document.querySelector('.menu-toggle');
      const menu = document.getElementById('primary-menu');
      function setOpen(open) {
        menu.classList.toggle('open', open);
        toggle.setAttribute('aria-expanded', String(open));
        toggle.setAttribute('aria-label', open ? 'Cerrar men√∫' : 'Abrir men√∫');
      }
      toggle.addEventListener('click', () => setOpen(!menu.classList.contains('open')));
      menu.addEventListener('click', (e) => {
        if (e.target.closest('a')) setOpen(false);
      });
      document.addEventListener('click', (e) => {
        if (menu.classList.contains('open')) {
          const within = e.target.closest('.nav-shell');
          if (!within) setOpen(false);
        }
      });
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') setOpen(false);
      });

      // Keyboard support for user-info
      document.querySelector('.user-info')?.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          showProfileModal();
        }
      });
    });
  </script>



</body>

</html>